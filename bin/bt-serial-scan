#!/bin/bash

# Read the bt-serial.conf file 
. /etc/bt-serial.conf


# If there are no known devices
if [ "$device01_mac" == "" ]; then

    # Discover devices
    while [[ $(hcitool scan | grep "RNBT") == "" ]]; do
        echo "No device Found!"
    done

    # Save device info to config
    device=$(hcitool scan | grep "RNBT")
    device_mac=$(echo $device | awk '{print $1}')
    device_name=$(echo $device | awk '{print $2}')
    sudo sed -i "s/device01_mac=\"\"/device01_mac=\"$device_mac\"/g" /etc/bt-serial.conf
    sudo sed -i "s/device01_name=\"\"/device01_name=\"$device_name\"/g" /etc/bt-serial.conf

    echo "device Found: $device"
fi

# Stop service once we have one?


# DEPRECATED
# If there are no devicees in rfcomm, add one
# if [ -n "$device01_mac" ] && [ "$device01_mac" != " " ] && ! sudo grep $device01_mac /etc/bluetooth/rfcomm.conf; then
#     sudo tee -a /etc/bluetooth/rfcomm.conf > /dev/null <<EOF
# rfcomm0 {
#     # Automatically bind the device at startup
#     bind yes;

#    # Bluetooth address of the device
#     device $device01_mac;

#     # RFCOMM channel for the connection
#     channel 1;

#     # Description of the connection
#     comment "Toothbrush";
# }
# EOF
# else
#     return
# fi



