#!/bin/bash
set -e

error_msg="Docker Compose failed to start."
echo "Starting Docker."
if [ -e /data/db/mongod.lock ]; then
    sudo rm -rf /data/db/mongod.lock
fi

# If hotspot mode is enabled, bypass it temporarily
if aux-cli hotspot -c; then
    aux-cli dhcpcd -s
fi

while [[ $(docker-compose up -d || echo "$error_msg") == "$error_msg" ]]; do
    echo "Docker isn't started yet."
    sleep 1
done

# If hotspot mode is enabled, bypass it temporarily
if aux-cli hotspot -c; then
    aux-cli dhcpcd -u
fi

echo "Docker is started."
