#!/bin/bash
set -e

read_conf() {
    . /etc/aux-cli.conf
}

install() {
    # Install Zero Tier
    echo "DEBUG: Installing ZeroTier..."
    curl -s https://install.zerotier.com/ | sudo bash

    # Join Zero Tier Network
    #sudo zerotier-cli join $zt_network && sudo zerotier-cli info

    sudo sed -i "s/^zerotier=\"false\"/zerotier=\"true\"/g" /etc/aux-cli.conf
}

uninstall() {
    sudo apt autoremove -y
    sudo apt-get remove zerotier-one
    sudo apt autoremove -y
    
    sudo sed -i "s/^zerotier=\"true\"/zerotier=\"false\"/g" /etc/aux-cli.conf
}

read_conf

if [ "$1" == "uninstall" ]; then
    if [ $zerotier == "true" ]; then
        uninstall
    else
        echo "ZeroTier is not installed. Skipping uninstallation."
    fi
else
    if [ $zerotier == "false" ]; then
        install
    else
        echo "ZeroTier is already installed. Skipping installation."
    fi
fi
